# 重新部署后需要更新的内容清单

> 如果重新部署合约，需要更新以下文档内容

## ⚠️ 重要说明：拍卖合约不需要重新部署

**拍卖合约（Auction）不需要重新部署**，原因如下：

1. **拍卖合约不依赖特定的 NFT 合约地址**
   - `createAuction()` 函数接受 `nftContract` 作为参数
   - 每次创建拍卖时都会传入 NFT 合约地址
   - 可以使用任何 ERC721 合约地址

2. **只需要在创建拍卖时使用新的 NFT 合约地址**
   - 旧拍卖合约可以继续使用
   - 创建新拍卖时，传入新部署的 NFT 合约地址即可

3. **什么情况下需要重新部署拍卖合约？**
   - ✅ 修改了拍卖合约的代码逻辑
   - ✅ 需要升级到新版本（V1 → V2）
   - ❌ **不需要**：仅仅因为 NFT 合约重新部署

**因此，如果只是重新部署 NFT 合约，只需要更新文档中 NFT 合约的地址，拍卖合约地址保持不变。**

---

## 📋 README.md 需要更新的内容

### 1. NFT 合约部署信息（第 361-367 行）

**位置**：`#### 3. 部署 NFT 合约` → `**部署信息**:`

需要更新：
- ✅ 合约地址
- ✅ 交易哈希
- ✅ Etherscan 链接（URL 中的地址）

```markdown
| 项目 | 值 |
|-----|---|
| 合约地址 | `[新地址]` |
| 交易哈希 | `[新交易哈希]` |
| Etherscan | [查看合约](https://sepolia.etherscan.io/address/[新地址]) |
```

---

### 2. 拍卖合约部署信息（第 394-402 行）

**位置**：`#### 4. 部署拍卖合约（V1）` → `**部署信息**:`

⚠️ **注意**：如果只是重新部署 NFT 合约，拍卖合约**不需要重新部署**，这部分内容保持不变。

只有在以下情况才需要更新：
- 修改了拍卖合约代码
- 需要升级拍卖合约版本

如果确实重新部署了拍卖合约，需要更新：
- ✅ 实现合约地址
- ✅ 代理合约地址
- ✅ 实现合约交易哈希
- ✅ 代理合约交易哈希
- ✅ Etherscan 链接（URL 中的地址）

```markdown
| 项目 | 值 |
|-----|---|
| 实现合约地址 | `[新地址]` |
| 代理合约地址 | `[新地址]` |
| 实现合约交易哈希 | `[新交易哈希]` |
| 代理合约交易哈希 | `[新交易哈希]` |
| Etherscan | [查看代理合约](https://sepolia.etherscan.io/address/[新地址]) |
```

---

### 3. 合约升级信息（第 499-505 行）

**位置**：`#### 2. 执行升级` → `**升级信息**:`

⚠️ **注意**：如果只是重新部署 NFT 合约，拍卖合约升级信息**不需要更新**，这部分内容保持不变。

只有在升级拍卖合约时才需要更新：
- ✅ V2 实现合约地址
- ✅ 升级交易哈希
- ✅ 部署交易哈希
- ✅ Etherscan 链接（URL 中的地址）

```markdown
| 项目 | 值 |
|-----|---|
| V2 实现合约地址 | `[新地址]` |
| 升级交易哈希 | `[新交易哈希]` |
| 部署交易哈希 | `[新交易哈希]` |
| Etherscan | [查看实现合约](https://sepolia.etherscan.io/address/[新地址]) |
```

---

### 4. 已部署合约信息表格（第 578-583 行）

**位置**：`## 已部署合约信息` → `### Sepolia 测试网`

需要更新：
- ✅ NFTMarketplace 地址和 Etherscan 链接（必须更新）
- ⚠️ 拍卖合约地址（如果重新部署了才需要更新，否则保持不变）

```markdown
| 合约 | 地址 | Etherscan |
|-----|------|-----------|
| NFTMarketplace | `[新地址]` | [查看](https://sepolia.etherscan.io/address/[新地址]) |
| Auction Proxy | `[保持不变或新地址]` | [查看](https://sepolia.etherscan.io/address/[地址]) |
| Auction Implementation (V1) | `[保持不变或新地址]` | [查看](https://sepolia.etherscan.io/address/[地址]) |
| Auction Implementation (V2) | `[保持不变或新地址]` | [查看](https://sepolia.etherscan.io/address/[地址]) |
```

---

## 📋 TEST_REPORT.md 需要更新的内容

### 1. 已部署合约地址表格（第 179-182 行）

**位置**：`#### 已部署合约地址`

需要更新：
- ✅ NFT 合约地址（必须更新）
- ⚠️ 拍卖代理合约地址（如果重新部署了才需要更新，否则保持不变）

```markdown
| 合约类型 | 地址 | Etherscan |
|---------|------|-----------|
| NFT 合约 | [新地址] | [查看](https://sepolia.etherscan.io/address/[新地址]) |
| 拍卖代理合约 | [保持不变或新地址] | [查看](https://sepolia.etherscan.io/address/[地址]) |
```

---

### 2. 铸造 NFT 测试结果（第 226-238 行）

**位置**：`#### 测试 4.2.2：铸造 NFT` → `**测试结果**:`

需要更新：
- ✅ 交易哈希
- ✅ 区块号
- ✅ Gas 使用量
- ✅ Etherscan 链接
- ⚠️ **Token ID**：从 `0` 改为 `1`（因为现在从 1 开始）
- ⚠️ 事件日志中的 Token ID

```markdown
交易哈希: [新交易哈希]
交易状态: ✅ 成功 (status: 1)
区块号: [新区块号]
Gas 使用量: [新Gas使用量]
元数据 URI: ipfs://[CID]

Etherscan: https://sepolia.etherscan.io/tx/[新交易哈希]

事件日志:
- Transfer 事件: NFT 从零地址转移到 Account B (0x354c393daf549da43485ffe85be464d82149b0e8)
- TokenURI 设置事件: Token ID 1 的 URI 已设置为 ipfs://[CID]
```

---

### 3. 查询 NFT 信息测试（第 257-267 行）

**位置**：`#### 测试 4.2.3：查询 NFT 信息`

需要更新：
- ⚠️ **Token ID**：从 `0` 改为 `1`（所有查询命令中的 tokenId）

```bash
# 查询 NFT 所有者（Token ID 1）
cast call $NFT_CONTRACT_ADDRESS \
  "ownerOf(uint256)(address)" \
  1 \
  --rpc-url $SEPOLIA_RPC_URL

# 查询 NFT 元数据（Token ID 1）
cast call $NFT_CONTRACT_ADDRESS \
  "tokenURI(uint256)(string)" \
  1 \
  --rpc-url $SEPOLIA_RPC_URL
```

---

### 4. 创建拍卖测试（第 285-302 行）

**位置**：`#### 测试 4.3.1：创建 ETH 拍卖`

需要更新：
- ⚠️ **Token ID**：从 `1` 改为 `1`（保持不变，因为现在从 1 开始）
- ✅ 交易哈希（在测试结果中）
- ✅ 拍卖 ID（如果有变化）

---

### 5. 验证结果测试（第 420-425 行）

**位置**：`#### 测试 4.3.7：验证结果`

需要更新：
- ⚠️ **Token ID**：从 `1` 改为 `1`（保持不变）

```bash
# 验证 NFT 已转移给 Account D（最高出价者）
cast call $NFT_CONTRACT_ADDRESS \
  "ownerOf(uint256)(address)" \
  1 \
  --rpc-url $SEPOLIA_RPC_URL
```

---

### 6. 综合场景测试表格（第 513-519 行）

**位置**：`#### 场景 1：完整拍卖流程`

需要更新：
- ⚠️ **Token ID**：所有提到 tokenId 的地方，从 `1` 改为 `1`（保持不变）
- ✅ 所有交易哈希
- ✅ 所有测试结果

---

## ⚠️ 重要注意事项

### Token ID 变化

由于合约已修改为从 **1** 开始（而不是 0），需要特别注意：

1. **所有测试命令中的 tokenId**：
   - 旧版本：`0`（第一个 NFT）
   - 新版本：`1`（第一个 NFT）

2. **测试结果中的 Token ID**：
   - 所有提到 "Token ID 0" 的地方改为 "Token ID 1"

3. **创建拍卖时的 tokenId**：
   - 如果使用第一个 NFT，应该使用 `1` 而不是 `0`

---

## 📝 更新检查清单

### README.md
- [ ] NFT 合约部署信息（地址、交易哈希、Etherscan 链接）**必须更新**
- [ ] 拍卖合约部署信息（仅当重新部署拍卖合约时才需要更新）
- [ ] 合约升级信息（仅当升级拍卖合约时才需要更新）
- [ ] 已部署合约信息表格（NFT 地址必须更新，拍卖地址按需更新）

### TEST_REPORT.md
- [ ] 已部署合约地址表格
- [ ] 铸造 NFT 测试结果（交易哈希、区块号、Gas、Token ID、Etherscan 链接）
- [ ] 查询 NFT 信息测试（Token ID）
- [ ] 创建拍卖测试（Token ID、交易哈希）
- [ ] 验证结果测试（Token ID）
- [ ] 综合场景测试（Token ID、交易哈希）
- [ ] 所有其他测试结果中的交易哈希和 Token ID

---

## 🔍 快速查找方法

使用以下命令快速找到需要更新的位置：

```bash
# 查找所有合约地址
grep -n "0x[0-9a-fA-F]\{40\}" README.md TEST_REPORT.md

# 查找所有交易哈希
grep -n "0x[0-9a-fA-F]\{64\}" README.md TEST_REPORT.md

# 查找所有 Token ID 0
grep -n "Token ID 0\|tokenId.*0\|ownerOf(0)" TEST_REPORT.md

# 查找所有 Etherscan 链接
grep -n "etherscan.io" README.md TEST_REPORT.md
```

---

## 💡 建议

1. **使用环境变量**：在 `.env` 文件中定义合约地址，然后在文档中引用
2. **使用占位符**：在文档中使用 `[NFT_CONTRACT_ADDRESS]` 等占位符，部署后统一替换
3. **版本控制**：在 Git 中标记部署版本，方便追踪
4. **自动化脚本**：可以编写脚本自动更新文档中的地址和哈希
